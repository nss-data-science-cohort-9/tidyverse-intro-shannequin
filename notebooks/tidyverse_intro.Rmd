---
title: "Tidyverse Introduction"
output: html_notebook
---

# Introduction to the Tidyverse: An Exploration of UN Data

In this project, you'll be redoing the UN Data project using the tidyverse libraries. You have been provided three csv files, gdp_per_capita.csv, life_expectancy.csv, and continents.csv.

Create a new R Notebook to complete this exercise.

```{r}
library(dplyr)
library(tidyverse)
```

## 1. Using the `read_csv()` function, read the GDP dataset into your notebook as a tibble called `gdp_df`.

After reading it in, inspect the first 10 rows and then inspect the last 10 rows.

*New code cell: CTRL + ALT + I*\
*Assignment: ALT + minus(-)*\
*Pipe: CTRL + SHIFT + M*

```{r}
# Read the data from a csv file
gdp_df <- read_csv("../data/gdp_per_capita.csv")
```

```{r}
# Display the top 10 rows
gdp_df |>
  head(10)

# Display the bottom 10 rows
gdp_df |>
  tail(10)
```

## 2. Drop the 'Value Footnotes' column, and rename the remaining columns to 'Country', 'Year', and 'GDP_Per_Capita'.

```{r}
gdp_df <- gdp_df |> 
  select(!'Value Footnotes') |> # Select all the variables except Value Footnotes
  rename(Country=`Country or Area`, GDP_Per_Capita=Value) # Rename the variables

# Display the formatted table
gdp_df |> 
  slice_sample(n=2)
```

## 3. Which years are represented in this dataset?

How many observations are there per year? Make a plot to view the number of observations per year.

```{r}
# Display the unique years
gdp_df |> 
  distinct(Year) |> # Get the unique years
  arrange(Year) # Sort by year ascending
```

```{r}
# Display the number of observations per year
gdp_df |> 
  group_by(Year) |> # Group by the year
  summarize(Observations=n()) # Get the number of observations
```

```{r}
# Plot the number of observations per year
gdp_df |> 
  ggplot(aes(x=Year)) + # Plot the years
  geom_bar() + # Use a bar graph
  labs(
    title="Number of Observations Per Year", # Set the graph title
    y="Observations" # Set the graph y axis label
  )
```

## 4. How many countries are represented in this dataset? Which countries have the fewest observations?

```{r}
# Get the number of countries
total_countries <- gdp_df |> 
  distinct(Country) |> # Get the unique countries
  count() |> # Count the number of countries
  pull() # Get the vector

total_countries # Display the total country count
```

```{r}
# Get the bottom 10% of countries
gdp_df |> 
  group_by(Country) |> # Group by the countries
  summarize(Observations=n() / total_countries) |> # Convert the country count to a percentage
  filter(Observations <= 0.1) # Filter observation counts that are less than 10%
```

## 5.  Create a new tibble by subsetting `gdp_df` to just the year 2021. Call this new tibble `gdp_2021`.

```{r}
# Create a new tibble with the GDP data from 2021
gdp_2021 <- gdp_df |> 
  filter(Year==2021)

# Display the new tibble
gdp_2021 |> 
  slice_sample(n=2)
```

## 6.  Use `summary()` to find the summary statistics for GDP per capita in 2021.

```{r}
gdp_2021 |> 
  summary()
```

## 7.  Create a histogram of GDP Per Capita numbers for 2021 (you may wish to adjust the number of bins for your histogram).

```{r}
# Create a histogram
gdp_2021 |> 
  ggplot(
    aes(x=GDP_Per_Capita) # Variables
  ) +
  geom_histogram(bins=10) # Graph type
```

## 8.  Find the top 5 counties and bottom 5 countries by GDP per capita in 2021.

```{r}
# Sort the tibble by GDP_Per_Capita
gdp_2021 <- gdp_2021 |> 
  arrange(GDP_Per_Capita)

# Display the top 5 countries
gdp_2021 |> 
  head(5)

#Display the bottom 5 countries
gdp_2021 |> 
  tail(5)
```

## 9.  Now, return to the full dataset, `gdp_df`. Pivot the data for 1990 and 2021 (using `pivot_wider()` function) so that each row corresponds to a country, each column corresponds to a year, and the values in the table give the GDP_Per_Capita amount. Drop any rows that are missing values for either 1990 or 2021. Save the result to a tibble named `gdp_pivoted`.

```{r}
# Get a widen tibble from gdp_df
gdp_pivoted <- gdp_df |> 
  mutate(Year = as.character(Year)) |> # Convert int to char
  filter(Year == "1990" | Year == "2021") |> # Filter year by 1990 and 2021
  pivot_wider(
    names_from = Year, # Use year values for variables
    values_from = GDP_Per_Capita, # Use GPD values for values
  ) |>
  drop_na() # Drop any rows with n/a

# Display a sample of gdp_pivoted
gdp_pivoted |>
  slice_sample(n=2)
```

## 10. Create a new column in `gdp_pivoted` named `Percent_Change`. This column should contain the percent change in GDP_Per_Capita from 1990 to 2021. Hint: Percent change is calculated as 100\*(New Value - Old Value) / Old Value.

```{r}
# Calculate percent change as new column
gdp_pivoted <- gdp_pivoted |> 
  mutate(Percent_Change = 100 * (`2021` - `1990`) / `1990`) 

# Display a sample of gdp_pivoted
gdp_pivoted |> 
  slice_sample(n=5)
```

## 11. How many countries experienced a negative percent change in GDP per capita from 1990 to 2021?

```{r}
# Filter by Percent_Change less than 100
negative_percent_change_count <- gdp_pivoted |> 
  filter(Percent_Change < 100) |> 
  count() |> 
  pull()

negative_percent_change_count
```

## 12. Which country had the highest % change in GDP per capita? Which country had the second highest % change? Create a line plot showing these country's GDP per capita for all years for which you have data. Put both line charts on the same plot.

```{r}
# Create a tibble with the top 2 countries by highest percent change
top_2_percent_change <- gdp_pivoted |> 
  arrange(desc(Percent_Change)) |> 
  head(2)

top_2_percent_change
```

```{r}
# Pull just the list of countries
top_2_list <- top_2_percent_change['Country'] |> 
  pull()

# Create a line graph of the 2 countries' GDP per capita
gdp_df |> 
  filter(Country %in% top_2_list) |> # Filter by the 2 required countries
  arrange(Year) |> # Sorty by year
  ggplot(aes(x = Year, y = GDP_Per_Capita, color = Country)) + # Set plot details
  geom_line() # Create a line graph
```

## 13. Read in continents.csv contained in the `data` folder into a new tibble called `continents`. We will be using this tibble to add a new column to our dataset.

```{r}
# Read the data from a csv file
continents <- read_csv("../data/continents.csv")

# Display a sample of the tibble
continents |> 
  slice_sample(n=5)
```

## 14. Merge gdp_df and continents. Keep only the countries that appear in both data frames. Save the result back to gdp_df.

```{r}
# Merge tibbles
gdp_df <- merge(x = gdp_df, y = continents)

# Display sample of tibble
gdp_df |> 
  slice_sample(n=5)
```

## 15. Determine the number of countries per continent. Create a bar chart showing this.

```{r}
# Get number of countries per continent
gdp_df |> 
  group_by(Continent) |> # Group by continent
  distinct(Country) |> # Filter by unique countries
  count() # Count number of rows
```

```{r}
# Graph number of countries by continent
gdp_df |> 
  group_by(Continent) |> # Group by continent
  distinct(Country) |> # Filter by unique countries
  ggplot(aes(x = Continent)) + # Set the plot details
  geom_bar() # Create the bar graph
```

## 16. Create a boxplot showing GDP per capita in 2021 split out by continent. What do you notice?

```{r}
gdp_df |> 
  group_by(Continent) |> 
  ggplot(aes(x = Continent, y = GDP_Per_Capita)) +
  geom_boxplot()
```

## 17. Read life_expectancy.csv into a tibble named life_expectancy. Do not modify the csv file in order to read this data in.

```{r}
# Read csv file skipping the first 3 lines
life_expectancy <- read_csv("../data/life_expectancy.csv", skip = 3)

# Display sample
life_expectancy |> 
  slice_sample(n = 2)
```

## 18. Drop the Country Code, Indicator Name, and Indicator Code columns. Then use `pivot_longer` to convert your data from wide to long. That is, instead of having one row per country and multiple colums per year, we want to have multiple rows per country and a single column for year. After melting, rename the columns to `Country`, `Year`, and `Life_Expectancy`.

```{r}
# Drop unnecessary columns
life_expectancy <- life_expectancy |> 
  select(!`Country Code`:`Indicator Code`)

# Display sample
life_expectancy |> 
  slice_sample(n = 2)
```

```{r}
# Pivot longer
life_expectancy <- life_expectancy |> 
  pivot_longer(!`Country Name`, names_to = "Year", values_to = "Life_Expectancy") |> 
  rename(Country = `Country Name`)

# Display sample
life_expectancy |> 
  slice_sample(n = 2)
```

## 19. What was the first country with a life expectancy to exceed 80?

```{r}
life_expectancy |> 
  filter(Life_Expectancy > 80.0) |> 
  arrange(Year) |> 
  head(1)
```

## 20. Merge `gdp_df` and `life_expectancy`, keeping all countries and years that appear in both tibbles. Save the result to a new tibble named `gdp_le`. If you get any errors in doing this, read them carefully and correct them. Look at the first five rows of your new data frame to confirm it merged correctly. Also, check the last five rows to make sure the data is clean and as expected.

```{r}
# Merge tibbles
gdp_le <- merge(x = gdp_df, y = life_expectancy)

# Display top five
gdp_le |> 
  head(5)
```

```{r}
# Display bottom five
gdp_le |> 
  tail(5)
```

21. Create a new tibble, named `gdp_le_2021` by extracting data for the year 2021 from `gdp_le`. How many countries have a life expectancy of at least 80 in 2021?

```{r}
# Filter by year 2021
gdp_le_2021 <- gdp_le |> 
  filter(Year == 2021)

# Filter life expectancy by 80+
gdp_le_2021 |> 
  filter(Life_Expectancy >= 80.0) |> 
  count()
```

## 22. Find the countries that had the top 3 largest GDP per capita figures for 2021. Create a plot showing the change in life expectancy over time for these three countries. This plot should be faceted so that each country is contained in its own figure.

```{r}
# Filter top 3 countries for GDP per capita
top_gdp_2021 <- gdp_le_2021 |> 
  arrange(desc(GDP_Per_Capita)) |> 
  head(3)

# Display tibble
top_gdp_2021
```

```{r}
# Create a list of the top 3 countries for GDP
top_gdp_2021_country_list <- as.list(top_gdp_2021$Country)

# Display list
top_gdp_2021_country_list
```

```{r}
# Create facet grid
gdp_le |> 
  filter(Country %in% top_gdp_2021_country_list) |> # Filter by top 3 countries by GDP
  group_by(Country) |> # Group by country
  ggplot(aes(x = Year, y = Life_Expectancy)) + # Set the plot data
  geom_point(aes(color = Country)) + # Create the plot
  facet_wrap(~Country) # Format as facet grid
```

## 23. Create a scatter plot of Life Expectancy vs GDP per Capita for the year 2021. What do you notice?

```{r}
# Graph a scatterplot
gdp_le_2021 |> 
  ggplot(aes(x = Life_Expectancy, y = GDP_Per_Capita)) + # Set plot data
  geom_point() # Create scatterplot
```

## 24. Find the correlation between Life Expectancy and GDP per Capita for the year 2021. What is the meaning of this number?

```{r}
# Calculate correlation
cor(x = gdp_le_2021['Life_Expectancy'], y = gdp_le_2021['GDP_Per_Capita'], method = "pearson", use = "na.or.complete")
```

## 25. Add a column to `gdp_le_2021` and calculate the logarithm of GDP per capita. Find the correlation between the log of GDP per capita and life expectancy. How does this compare to the calculation in the previous part? Look at a scatter plot to see if the result of this calculation makes sense.

```{r}
# Add column for log of GDP
gdp_le_2021 <- gdp_le_2021 |> 
  mutate(Log_GDP = log(GDP_Per_Capita))

# Display sample
gdp_le_2021 |> 
  slice_sample(n = 2)
```

```{r}
# Calculate correlation
cor(x = gdp_le_2021['Life_Expectancy'], y = gdp_le_2021['Log_GDP'], method = "pearson", use = "na.or.complete")
```